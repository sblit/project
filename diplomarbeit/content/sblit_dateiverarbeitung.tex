\subsection{Allgemein}
Ein wesentlicher Bestandteil von sblit ist die Verarbeitung der Dateien. Dazu zählt das Erkennen von Änderungen und das Erkennen und Lösen von Konflikten.
\subsubsection{Logfile} \label{Logfile}
Ein wichtiges Mittel zur Verwaltung der Dateien ist das Logfile. Dieses enthält Informationen zu allen Dateien, die im sblit-Ordner gespeichert sind. Dazu zählen der relative Dateipfad, eine Liste an Hashes, die für die Versionierung zuständig sind, und eine Liste an Geräten, auf denen die Datei bereits auf dem aktuellen Stand ist. Die Versionierung ist vor allem für die Konflikterkennung notwendig. Hierbei werden Hashes für jede Version aller Dateien gespeichert. Diese wird beim Speichern der Datei um den aktuellen Hashwert erweitert und bei Konvergenz auf allen Geräten auf die aktuelle gemeinsame Version reduziert. Informationen über die Konflikterkennung können im Kapitel \nameref{Konflikterkennung} auf der Seite \pageref{Konflikterkennung} in Erfahrung gebracht werden. \\
Damit sblit weiß, wann die Dateien von den Partnergeräten (siehe "\nameref{Partergerät}" auf Seite \pageref{Partergerät} wieder gelöscht werden können, wird die Liste mit den Geräten, auf denen die Datei auf dem aktuellen Stand ist, gespeichert. Die Liste wird bei jeder Änderung mit der Liste aller eigenen Geräte verglichen. Sobald hier alle eigenen Geräte eingetragen sind, werden die Partnergeräte dazu aufgefordert, die Datei zu löschen. 

\subsubsection{Reaktionen auf Dateiänderungen}
Wenn eine Datei neu erstellt, bearbeitet oder gelöscht wird, erkennt dies sblit und kann diese Daten an den Synchronisationsprozess weiterleiten. Außerdem ist das Erkennen einer Änderung im sblit-Ordner wichtig, da diese im Logfile protokolliert wird. Dieses wird sowohl für die Konflikterkennung (siehe "\nameref{Konflikterkennung}" auf Seite \pageref{Konflikterkennung}) als auch für eine Reduktion der benötigten Bandbreite (siehe "\nameref{Dateianfragen}" auf Seite \pageref{Dateianfragen}) verwendet.\\
Um diese Änderungen zu erkennen, verwendet sblit das sogenannte Watchservice. Das Watchservice ist eine Schnittstelle zum Dateisystem, welche vom Dateisystem benachrichtigt wird, wenn sich eine Datei in einem bestimmten Ordner ändert. In diesem Fall ist das der Ordner, der vom Benutzer für die Synchronisation festgelegt wurde. Je nach dem, ob eine Datei angelegt, verändert oder gelöscht wurde, passieren drei unterschiedliche Dinge. Wird eine Datei angelegt, werden eine neue Datei samt Hash in das Logfile geschrieben und eine Dateianfrage an die anderen, eigenen Geräte geschickt. Wird eine bereits vorhandene Datei verändert, werden ein neuer Hash zu den bereits vorhandenen Hashes hinzugefügt und ebenfalls eine Dateianfrage an die anderen eigenen Geräte gesendet. Wird die Datei gelöscht, wird diese samt Hashes aus dem Logfile gelöscht und eine Löschanfrage wird an die eigenen Geräte versendet.
 
\subsection{Konflikte}\label{Konflikt}
\subsubsection{Allgemein}
Ein Konflikt ist ein Problem, dass bei Synchronisationsdiensten vorkommt. Dieser tritt auf, wenn eine Datei bearbeitet wird, bevor diese synchronisiert werden kann. Dazu ein Beispiel: Susanne hat einen Laptop und einen Stand-Rechner, auf denen sie mithilfe von sblit einen Ordner synchronisiert. Im Normalfall, also wenn kein Konflikt auftritt, bearbeitet Susanne eine Datei auf dem Laptop. Nach dem Speichern wird die Datei auf den Stand-Rechner übertragen und dort gespeichert. Die Datei ist nun auf beiden Geräten synchron.\\
Angenommen, Susanne schaltet nun den Laptop aus. Später bearbeitet sie die Datei noch einmal auf dem Stand-Rechner. Da der Laptop ausgeschaltet ist, kann die Datei nicht synchronisiert werden. Auf dem Weg zur Arbeit fällt Susanne noch eine Verbesserungsmöglichkeit der Datei ein und sie bearbeitet die Datei auf dem Laptop ohne einer Verbindung zum Internet. In der Arbeit angekommen, packt Susanne wieder ihren Laptop aus und verbindet sich zum Internet. Die Datei kann jetzt nicht auf den neusten Stand gebracht werden, da ja zwei unterschiedliche Versionen existieren. Würde die Datei einfach vom Stand-Rechner auf den Laptop kopiert werden, gingen die Neuerungen am Laptop verloren, umgekehrt würde die Datei vom Laptop die Änderungen am Stand-Rechner überschreiben. Diesen Zustand zweier verschiedener Versionen ohne die jeweils anderen Änderungen nennt man einen Konflikt.
%TODO eventuell noch ergänzen

\subsubsection{Konflikterkennung}\label{Konflikterkennung}
Um Konflikte zu erkennen, verwendet sblit eine interne Versionierung der Dateien. Diese wird im Kapitel "\nameref{Logfile}" auf der Seite \pageref{Logfile} näher erklärt. Bei einer Dateianfrage (siehe "\nameref{Dateianfragen}" auf Seite \pageref{Dateianfragen}) werden alle Hashes einer Datei mitgesendet. Diese werden nach dem Empfang der Anfrage dann mit dem lokalen Logfile verglichen. Stimmen die beiden aktullen Hashes aus Dateianfrage und Logfile überein, muss die Datei gar nicht übertragen werden, da sie schon auf dem neusten Stand ist. Das heißt natürlich auch, dass kein Konflikt auftritt. Stimmt der aktuelle Hash im lokalen Logfile mit einem in der Dateianfrage überein, tritt ebenfalls kein Konflikt auf, da der aktuelle lokale Hash dem Gerät, dass die Anfrage verschickt hat, schon bekannt ist. \\
Ist der aktuelle Hash der lokalen Datei jedoch nicht in der Dateianfrage enthalten, wurde die lokale Datei bearbeitet, bevor diese auf den aktuellen Stand gebracht werden konnte. Anders gesagt: Ein Konflikt ist aufgetreten.

\subsubsection{Konfliktlösung}
Damit die Änderungen von einem Gerät nicht überschrieben werden, speichert sblit beide Versionen. Da jedoch beide Dateien nicht den gleichen Namen haben können, benennt das Gerät, das den Konflikt erkennt, (im Folgenden Gerät A) die lokale Datei um. Anschließend schickt Gerät A eine Antwort an das Gerät, das die Dateianfrage geschickt hat,  (im Folgenden Gerät B) in der es die neue Version anfordert, als ob kein Konflikt aufgetreten wäre. Außerdem schickt Gerät A eine Dateianfrage mit der neuen Datei an Gerät B. Gerät B sendet nun die angeforderte Datei an Gerät A und akzeptiert die Konfliktdatei, da es eine Datei mit dem gleichen Namen noch nicht besitzt. \\
Nach dem Empfang der Datei speichtert Gerät A diese unter dem ursprünglichen Namen. Des Weiteren sendet Gerät A die Konfliktdatei mit dem geänderten Namen an Gerät B. Die neue Datei wird auf Gerät B unter dem neuen Namen gespeichert.
